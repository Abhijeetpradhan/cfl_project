<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cavisson Football League</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Segoe UI",Roboto,Arial,sans-serif;
  background:
    linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.85)),
    url("stadium.png") center/cover fixed;
  color:#fff;
  overflow:hidden;
}

/* ===== CONTAINER ===== */
.container{
  max-width:1500px;
  height:100vh;
  margin:auto;
  padding:14px;
  display:flex;
  flex-direction:column;
}

/* ===== TITLE ===== */
h1{
  text-align:center;
  font-size:44px;
  margin:6px 0 10px;
}

/* ===== LAYOUT ===== */
.main-layout{
  display:grid;
  grid-template-columns:2.6fr 1fr;
  gap:14px;
  flex:1;
}

/* ===== CARDS ===== */
.card{
  backdrop-filter:blur(18px);
  border-radius:18px;
  box-shadow:0 16px 40px rgba(0,0,0,.7);
  padding:14px;
}
.card.standings{background:rgba(12,22,38,.75)}
.card.matches{background:rgba(15,23,42,.45)}
.card.knockout{background:rgba(10,18,32,.9);margin-top:6px}

/* ===== TITLES ===== */
.section-title{
  text-align:center;
  font-size:22px;
  margin-bottom:8px;
  font-weight:600;
}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse;font-size:15px}
th{background:rgba(2,6,23,.95);padding:8px}
td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,.12)}
.standings-table td:first-child{text-align:left}

.name-cell{
  display:grid;
  grid-template-columns:26px auto 18px;
  align-items:center;
  gap:8px;
}
.flag{font-size:18px}

/* ===== HIGHLIGHTS ===== */
.leader{
  background:linear-gradient(90deg,rgba(56,189,248,.45),transparent);
  font-weight:bold;
}
.last-place{
  background:linear-gradient(90deg,rgba(239,68,68,.45),transparent);
  font-weight:bold;
}

/* ===== ARROWS ===== */
.arrow-up{color:#22c55e;font-weight:bold}
.arrow-down{color:#ef4444;font-weight:bold}

/* ===== FORM ===== */
.form{display:flex;justify-content:center;gap:4px}
.form span{
  width:18px;height:18px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;font-weight:bold
}
.win{background:#22c55e}
.draw{background:#9ca3af}
.loss{background:#ef4444}

/* ===== INPUTS ===== */
input{
  width:32px;
  padding:4px;
  background:rgba(2,6,23,.95);
  color:#fff;
  border-radius:5px;
  border:none;
  text-align:center;
  font-size:14px;
}

/* ===== MATCHES ===== */
.round{margin-bottom:6px}
.round-title{
  font-weight:600;
  font-size:15px;
  border-bottom:1px solid rgba(255,255,255,.15);
  margin-bottom:4px
}
.match-row{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  gap:6px;
  margin-bottom:4px;
  font-size:14px
}
.team-left{text-align:right}
.team-right{text-align:left}
.score-box{display:flex;gap:4px}

/* ===== KNOCKOUT ===== */
.knockout-grid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:12px;
}
.kcard{
  background:rgba(15,23,42,.65);
  border-radius:14px;
  padding:14px;
  text-align:center;
  font-size:15px
}
.final{border:3px solid gold}
.penalties{display:none;margin-top:6px;gap:6px;justify-content:center}

/* ===== TROPHY ===== */
.trophy{
  font-size:80px;
  margin-bottom:6px;
  animation:bounce 1.5s infinite, glow 2s infinite;
}
@keyframes bounce{50%{transform:translateY(-10px)}}
@keyframes glow{50%{text-shadow:0 0 28px gold}}

/* ===== WINNER ===== */
#winner{
  text-align:center;
  font-size:30px;
  font-weight:800;
  color:gold;
  margin-top:6px;
}

/* ===== FIREWORKS ===== */
canvas{position:fixed;inset:0;pointer-events:none}
</style>
</head>

<body>
<canvas id="fireworks"></canvas>

<div class="container">
<h1>CFL</h1>

<div class="main-layout">
  <div class="card standings">
    <div class="section-title">Standings</div>
    <table id="standings" class="standings-table"></table>
  </div>

  <div class="card matches">
    <div class="section-title">League Matches</div>
    <div id="matches"></div>
  </div>
</div>

<div class="card knockout" id="knockout" style="display:none">
  <div class="section-title">üèÜ Knockout Stage</div>
  <div class="knockout-grid">
    <div class="kcard" id="sf1"></div>
    <div class="kcard final" id="final"></div>
    <div class="kcard" id="sf2"></div>
  </div>
  <div id="winner"></div>
</div>
</div>

<script>
/* ================= LEAGUE LOGIC ================= */
const players=["Joker","MrA","Rajesh","Deadman","Maytas"];
const flags={Joker:"üá´üá∑",MrA:"üá¶üá∑",Rajesh:"üá™üá∏",Deadman:"üáµüáπ",Maytas:"üá´üá∑"};
const rounds=[
 {name:"Round 1",games:[["Deadman","Maytas"],["MrA","Joker"]]},
 {name:"Round 2",games:[["Rajesh","MrA"],["Joker","Deadman"]]},
 {name:"Round 3",games:[["Joker","Maytas"],["Rajesh","Deadman"]]},
 {name:"Round 4",games:[["Deadman","MrA"],["Maytas","Rajesh"]]},
 {name:"Round 5",games:[["Rajesh","Joker"],["MrA","Maytas"]]}
];

const stats={};players.forEach(p=>stats[p]={mp:0,w:0,d:0,l:0,gf:0,ga:0,pts:0});
const STORAGE_KEY="scores",RANK_KEY="ranks";
const matchContainer=document.getElementById("matches");

/* render matches */
rounds.forEach((r,ri)=>{
 const d=document.createElement("div");
 d.className="round";
 d.innerHTML=`<div class="round-title">${r.name}</div>`;
 r.games.forEach((g,gi)=>{
  d.innerHTML+=`
  <div class="match-row">
    <div class="team-left">${g[0]}</div>
    <div class="score-box">
      <input data-r="${ri}" data-g="${gi}" data-t="a"> -
      <input data-r="${ri}" data-g="${gi}" data-t="b">
    </div>
    <div class="team-right">${g[1]}</div>
  </div>`;
 });
 matchContainer.appendChild(d);
});

const inputs=document.querySelectorAll("input");
const saved=JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");
inputs.forEach(i=>{
 const k=i.dataset.r+i.dataset.g+i.dataset.t;
 if(saved[k]!=null) i.value=saved[k];
 i.oninput=saveAndUpdate;
});

updateLeague();

function saveAndUpdate(){
 const d={};
 inputs.forEach(i=>{if(i.value!=="") d[i.dataset.r+i.dataset.g+i.dataset.t]=i.value});
 localStorage.setItem(STORAGE_KEY,JSON.stringify(d));
 updateLeague();
}

function updateLeague(){
 players.forEach(p=>stats[p]={mp:0,w:0,d:0,l:0,gf:0,ga:0,pts:0});
 const form={};players.forEach(p=>form[p]=[]);
 let played=0,total=rounds.flatMap(r=>r.games).length;

 rounds.forEach((r,ri)=>{
  r.games.forEach((g,gi)=>{
   const a=document.querySelector(`[data-r="${ri}"][data-g="${gi}"][data-t="a"]`).value;
   const b=document.querySelector(`[data-r="${ri}"][data-g="${gi}"][data-t="b"]`).value;
   if(a===""||b==="") return;
   played++;
   const sa=+a,sb=+b,A=g[0],B=g[1];
   stats[A].mp++;stats[B].mp++;
   stats[A].gf+=sa;stats[A].ga+=sb;
   stats[B].gf+=sb;stats[B].ga+=sa;
   if(sa>sb){stats[A].w++;stats[A].pts+=3;stats[B].l++;form[A].push("W");form[B].push("L")}
   else if(sb>sa){stats[B].w++;stats[B].pts+=3;stats[A].l++;form[B].push("W");form[A].push("L")}
   else{stats[A].d++;stats[B].d++;stats[A].pts++;stats[B].pts++;form[A].push("D");form[B].push("D")}
  });
 });

 const sorted=[...players].sort((x,y)=>stats[y].pts-stats[x].pts||(stats[y].gf-stats[y].ga)-(stats[x].gf-stats[x].ga));
 renderStandings(sorted,form);
 if(played===total) showKnockout(sorted);
}

function renderStandings(sorted,form){
 const prev=JSON.parse(localStorage.getItem(RANK_KEY)||"{}");
 const next={};
 const t=document.getElementById("standings");
 t.innerHTML=`<tr>
  <th>Club</th><th>MP</th><th>W</th><th>D</th><th>L</th>
  <th>GF</th><th>GA</th><th>GD</th><th>Pts</th><th>Last 4</th>
 </tr>`;
 sorted.forEach((p,i)=>{
  next[p]=i;
  let arrow="";
  if(prev[p]!=null){
   if(prev[p]>i) arrow=`<span class="arrow-up">‚¨Ü</span>`;
   else if(prev[p]<i) arrow=`<span class="arrow-down">‚¨á</span>`;
  }
  const f=form[p].slice(-4).map(r=>r==="W"?`<span class="win">‚úì</span>`:r==="D"?`<span class="draw">‚Äì</span>`:`<span class="loss">‚úï</span>`).join("");
  t.innerHTML+=`
  <tr class="${i===0?'leader':i===sorted.length-1?'last-place':''}">
   <td><div class="name-cell"><span class="flag">${flags[p]}</span>${p}${arrow}</div></td>
   <td>${stats[p].mp}</td><td>${stats[p].w}</td><td>${stats[p].d}</td><td>${stats[p].l}</td>
   <td>${stats[p].gf}</td><td>${stats[p].ga}</td><td>${stats[p].gf-stats[p].ga}</td>
   <td>${stats[p].pts}</td><td><div class="form">${f}</div></td>
  </tr>`;
 });
 localStorage.setItem(RANK_KEY,JSON.stringify(next));
}

/* ================= KNOCKOUT ================= */
function showKnockout(sorted){
 document.getElementById("knockout").style.display="block";
 const [a,b,c,d]=sorted.slice(0,4);
 renderMatch("sf1","Semi Final",a,d,w1=>{
  renderMatch("sf2","Semi Final",b,c,w2=>{
   renderFinal(w1,w2);
  });
 });
}

function renderMatch(id,title,A,B,cb){
 const el=document.getElementById(id);
 el.innerHTML=`
 <h3>${title}</h3>
 <div class="match-row">
  <div class="team-left">${A}</div>
  <div class="score-box"><input class="g1"> - <input class="g2"></div>
  <div class="team-right">${B}</div>
 </div>
 <div class="penalties">Pen <input class="p1"> - <input class="p2"></div>`;
 const g1=el.querySelector(".g1"),g2=el.querySelector(".g2");
 const pWrap=el.querySelector(".penalties"),p1=el.querySelector(".p1"),p2=el.querySelector(".p2");
 function decide(){
  if(g1.value===""||g2.value==="") return;
  if(+g1.value!==+g2.value) cb(+g1.value>+g2.value?A:B);
  else{
   pWrap.style.display="flex";
   if(p1.value!==""&&p2.value!==""&&+p1.value!==+p2.value)
    cb(+p1.value>+p2.value?A:B);
  }
 }
 [g1,g2,p1,p2].forEach(i=>i.oninput=decide);
}

function renderFinal(A,B){
 renderMatch("final","Final",A,B,w=>{
  document.getElementById("winner").innerHTML=
   `<div class="trophy">üèÜ</div>${w} IS THE 1ST CHAMPION OF CFL`;
  startFireworks();
 });
}

/* ================= FIREWORKS ================= */
const canvas=document.getElementById("fireworks"),ctx=canvas.getContext("2d");
canvas.width=innerWidth;canvas.height=innerHeight;
function startFireworks(){
 let p=[];
 setInterval(()=>{
  for(let i=0;i<200;i++)
   p.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height/2,vx:(Math.random()-.5)*9,vy:(Math.random()-.5)*9,l:90});
 },400);
 (function anim(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  p.forEach(o=>{
   o.x+=o.vx;o.y+=o.vy;o.l--;
   ctx.fillStyle="gold";
   ctx.fillRect(o.x,o.y,3,3);
  });
  p=p.filter(o=>o.l>0);
  requestAnimationFrame(anim);
 })();
}
</script>
</body>
</html>

